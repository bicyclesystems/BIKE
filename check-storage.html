<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Storage Inspector</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      .section {
        margin: 20px 0;
        padding: 15px;
        border: 1px solid #ccc;
        border-radius: 5px;
      }
      .key {
        font-weight: bold;
        color: #333;
      }
      .value {
        background: #f5f5f5;
        padding: 5px;
        margin: 5px 0;
        border-radius: 3px;
        font-family: monospace;
      }
      .db-item {
        margin: 10px 0;
        padding: 10px;
        background: #f9f9f9;
        border-left: 3px solid #007cba;
      }
      .error {
        color: red;
      }
      .success {
        color: green;
      }
    </style>
  </head>
  <body>
    <h1>Storage Inspector</h1>

    <div class="section">
      <h2>LocalStorage Data</h2>
      <div id="localStorageData"></div>
    </div>

    <div class="section">
      <h2>IndexedDB Data</h2>
      <div id="indexedDBData"></div>
    </div>

    <script>
      // Check LocalStorage
      function checkLocalStorage() {
        const container = document.getElementById("localStorageData");
        const data = {};

        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          const value = localStorage.getItem(key);
          data[key] = value;
        }

        if (Object.keys(data).length === 0) {
          container.innerHTML =
            '<p class="success">No localStorage data found</p>';
          return;
        }

        let html =
          '<p class="success">Found ' +
          Object.keys(data).length +
          " localStorage items:</p>";
        for (const [key, value] of Object.entries(data)) {
          html += `
                    <div class="db-item">
                        <div class="key">Key: ${key}</div>
                        <div class="value">Value: ${value}</div>
                    </div>
                `;
        }
        container.innerHTML = html;
      }

      // Check IndexedDB
      function checkIndexedDB() {
        const container = document.getElementById("indexedDBData");

        if (!window.indexedDB) {
          container.innerHTML = '<p class="error">IndexedDB not supported</p>';
          return;
        }

        const request = indexedDB.open("BIKE", 1);

        request.onerror = function () {
          container.innerHTML = '<p class="error">Could not open IndexedDB</p>';
        };

        request.onsuccess = function (event) {
          const db = event.target.result;
          let html = '<p class="success">IndexedDB opened successfully</p>';

          // List all object stores
          const objectStores = Array.from(db.objectStoreNames);
          html += "<p>Object Stores: " + objectStores.join(", ") + "</p>";

          if (objectStores.length === 0) {
            html += '<p class="success">No object stores found</p>';
            container.innerHTML = html;
            return;
          }

          // Check each object store
          let storeCount = 0;
          objectStores.forEach((storeName) => {
            const transaction = db.transaction([storeName], "readonly");
            const objectStore = transaction.objectStore(storeName);
            const request = objectStore.getAll();

            request.onsuccess = function () {
              const data = request.result;
              html += `
                            <div class="db-item">
                                <h3>Store: ${storeName}</h3>
                                <p>Records: ${data.length}</p>
                        `;

              if (data.length > 0) {
                html += '<div class="value">';
                data.forEach((item, index) => {
                  html += `<div><strong>Record ${
                    index + 1
                  }:</strong> ${JSON.stringify(item, null, 2)}</div>`;
                });
                html += "</div>";
              }

              html += "</div>";
              storeCount++;

              if (storeCount === objectStores.length) {
                container.innerHTML = html;
              }
            };

            request.onerror = function () {
              html += `<p class="error">Error reading from store: ${storeName}</p>`;
              storeCount++;
              if (storeCount === objectStores.length) {
                container.innerHTML = html;
              }
            };
          });
        };

        request.onupgradeneeded = function () {
          container.innerHTML =
            '<p class="error">IndexedDB needs upgrade - no data found</p>';
        };
      }

      // Run checks when page loads
      window.addEventListener("load", function () {
        checkLocalStorage();
        checkIndexedDB();
      });
    </script>
  </body>
</html>
